
<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>COOPERVISION - Simulateur CA contactologie</title>
<style>
    :root { --bg:#f7f8fa; --banner-bg:#0f172a; --banner-fg:#ffffff; --card-bg:#ffffff; --card-border:#e5e7eb; --accent:#2563eb; --muted:#6b7280; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif; background:var(--bg); color:#111827; }
    header{ background:linear-gradient(90deg,#0f172a,#1e3a8a); color:var(--banner-fg); padding:18px 24px; border-bottom:4px solid #2563eb; position:sticky; top:0; z-index:10; }
    header h1{ margin:0; font-size:1.25rem; letter-spacing:0.2px; }
    label { font-weight: 600; color: #333; }
    input[type="text"], input[type="number"]{ width:100%; padding:8px 10px; border:1px solid var(--card-border); border-radius:6px; outline:none; }
    input[type="text"]:focus, input[type="number"]:focus{ border-color:#93c5fd; box-shadow:0 0 0 3px rgba(147,197,253,0.35); }
    h2{ margin:0 0 12px 0; text-align: center;font-size:1rem; color:#111827; }
    .container{ display:flex; gap:16px; padding:16px; align-items:stretch; }
    .panel{ background:var(--card-bg); border:1px solid var(--card-border); border-radius:10px; padding:16px; box-shadow:0 1px 3px rgba(0,0,0,0.06),0 1px 2px rgba(0,0,0,0.04); }
    .left{ flex:1 1 30%; min-width:380px; }
    .right{ flex:1 1 70%; min-width:420px; }
    .form-row{ display:grid; grid-template-columns: 1fr 160px; gap:8px; margin-bottom:12x; }
    .form-row.readonly input{ background:#f8fafc; color:#6b7280; }
    .toolbar{ display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; align-items:center; }
    .toolbar .grow{ flex:1; }
    button{ padding:8px 12px; border:1px solid var(--card-border); border-radius:8px; background:#f3f4f6; cursor:pointer; font-weight:600; width: 100% }
    button.primary { background: #005FB8; color:#fff; border-color: var(--primary); }
    button.danger{ background:#ef4444; color:white; border-color:#dc2626; }
    button.neutral{ background:#e5e7eb; color:#111827; }
    button:hover { background:#BFBFBF; }
    .hint{ font-size:0.85rem; color:var(--muted); margin-top:6px; }
    #chartWrapper{ position:relative; height:420px; }
    #chart{ width:100%; height:100%; border-radius:8px; background:#ffffff; }
    .legend{ display:flex; flex-wrap:wrap; gap:8px 12px; margin-top:10px; color:var(--muted); font-size:0.9rem; }
    .legend .item{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border:1px dashed var(--card-border); border-radius:6px; background:#f8fafc; }
    .legend .swatch{ width:14px; height:14px; border-radius:3px; display:inline-block; }
    @media (max-width:900px){ .container{ flex-direction:column; } .left,.right{ min-width:100%; } }
    .ligne-champ {display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 16px; }
    .ligne-champ label {min-width: 200px; font-weight: 600;font-size: 16px; }
    .ligne-champ input {flex: 1; padding: 6px 8px;font-size: 10px; }
  

header .header-content { display:flex; align-items:center; gap:12px; flex-wrap:nowrap; }
header .header-content .logo { height:auto; width:auto; max-height:48px; max-width:160px; }
@media (max-width: 600px) {
  header .header-content .logo { max-height:36px; max-width:120px; }
  header .header-content h1 { font-size:1rem; }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script></head>
<body>
<header><div class="header-content"><img alt="CooperVision" class="logo" src="logo.png"/><h1>COOPERVISION - Simulateur CA contactologie</h1></div></header>
<div class="container">
<section class="panel left">
<h2>Données client</h2>
<div id="rows">
<!-- Creation des labels et inputs -->
<div class="ligne-champ">
<label for="caGlobalActuel">CA Global - Actuel (€)</label>
<input id="caGlobalActuel" min="0" placeholder="Saisir une valeur" required="" step="1000" type="number"/>
</div>
<div class="ligne-champ">
<label for="caLentillesActuel">CA Lentilles - Actuel (€)</label>
<input id="caLentillesActuel" min="0" placeholder="Saisir une valeur" required="" step="1000" type="number"/>
</div>
<div class="ligne-champ">
<label for="objectifPct">Objectif contactologie (%)</label>
<input id="objectifPct" max="30" min="0" placeholder="Entrer un pourcentage" step="1" type="number"/>
</div>
<div class="ligne-champ">
<label for="caGlobalProjete">CA Global - Projeté (€)</label>
<input disabled="" id="caGlobalProjete" placeholder="Calcul automatique" type="number"/>
</div>
<div class="ligne-champ">
<label for="caLentillesProjete">CA Lentilles - Projeté (€)</label>
<input disabled="" id="caLentillesProjete" placeholder="Calcul automatique" type="number"/>
</div>
<div class="toolbar">
<!-- Ajout des boutons -->
<button class="primary" id="btnUpdate">Actualiser les données + graphique</button>
<button class="primary" id="btnSaveBar">Enregistrer le graphique</button>
<button class="primary" id="btnMail">Envoyer par mail</button>
<button class="danger" id="clearBtn">Tout effacer</button>
</div>
</div></section>
<section class="panel right">
<h2>Evolution du Chiffre d'Affaires CONTACTOLOGIE</h2>
<div id="chartWrapper"><canvas id="chart"></canvas></div>
</section>
</div>
<script>

    const val = (id) => {
      const el = document.getElementById(id);
      const v = parseFloat((el.value || "").replace(",", "."));
      return isNaN(v) ? null : v;
    };
    const setVal = (id, v) => {
      const el = document.getElementById(id);
      el.value = (v ?? "").toString();
    };


   //fonctions,
    function fmtEuro(v){
      if (isNaN(v) || v === null) return '';
      return new Intl.NumberFormat('fr-FR', { style:'currency', currency:'EUR', maximumFractionDigits:0 }).format(v);
     }
    function fmtPercent(v){
      if (isNaN(v) || v === null) return '';
      return new Intl.NumberFormat('fr-FR', { style:'percent', maximumFractionDigits:0 }).format(v);
     }

    function recalculerProjections() {
      const caGlobal = parseFloat(document.getElementById('caGlobalActuel').value || '0');
      const caLens = parseFloat(document.getElementById('caLentillesActuel').value || '0');
      const pct = parseFloat(document.getElementById('objectifPct').value || '0');
      const factor = pct //1 + (pct/100);
      const caLensProjete = caGlobal * pct //(factor - 1);
      const caMagProjete = (caLensProjete - caLens) * 4 + caGlobal;
      document.getElementById('caGlobalProjete').value = fmtEuro(caMagProjete);
      document.getElementById('caLentillesProjete').value = fmtEuro(caLensProjete);
    }


    //Bouton effacer,
      document.getElementById('clearBtn').addEventListener('click', () => {
      const inputs = document.querySelectorAll("input");
      inputs.forEach(input => input.value = "");
     });

    //Bouton actualiser,
      document.getElementById('btnUpdate').addEventListener('click', () => {
      recalculerProjections();
     });

  </script>

<script>
(function(){
  // Register plugin
  if (typeof Chart !== 'undefined' && typeof ChartDataLabels !== 'undefined') { Chart.register(ChartDataLabels); }
  // Format EUR
  function fmtEUR(v){ try { return new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(v);} catch(e){ return v; } }
  // Force projected fields as text
  ['caGlobalProjete','caLentillesProjete'].forEach(function(id){ const el=document.getElementById(id); if(el){ el.setAttribute('type','text'); el.setAttribute('disabled','true'); }});
  // Compute projections
  function computeProjections(){
    const G0 = parseFloat(document.getElementById('caGlobalActuel').value || '0');
    const L0 = parseFloat(document.getElementById('caLentillesActuel').value || '0');
    const tPct = parseFloat(document.getElementById('objectifPct').value || '0');
    const t = Math.max(0, tPct) / 100; 
    const N0 = Math.max(0, G0 - L0);
    let G1 = NaN, L1 = NaN; if (t < 1) { L1 = t * G0; G1 = (L1 - L0) * 4 + G0; }
    return { G0, L0, G1, L1 };
  }
  let barChart;
  function buildChart(){
    const ctx = document.getElementById('chart').getContext('2d');
    const { G0, L0, G1, L1 } = computeProjections();
    barChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['CA ACTUEL', 'CA PROJETÉ'],
        datasets: [
          { label:'CA Global',    pointStyle:'circle', backgroundColor:'#1d4ed8', borderColor:'#0b3aa7', borderWidth:2, data:[G0, Number.isFinite(G1)?G1:0] },
          { label:'CA Lentilles', pointStyle:'circle', backgroundColor:'#f59e0b', borderColor:'#c47400', borderWidth:2, data:[L0, Number.isFinite(L1)?L1:0] }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 14, boxHeight: 14 } },
          datalabels: {
            anchor: 'end', align: 'end', offset: 4, color: '#111827', font: { weight: '700' },
            formatter: function(value) { return fmtEUR(value); }
          },
          tooltip: { callbacks: { label: function(ctx){ return ctx.dataset.label + ': ' + fmtEUR(ctx.parsed.y); } } }
        },
        scales: { y: { beginAtZero:true, ticks:{ callback:function(v){ return fmtEUR(v); } } }, x: { grid: { display:false } } }
      }
    });
  }
  function updateChart(){
    const { G0, L0, G1, L1 } = computeProjections();
    const gEl=document.getElementById('caGlobalProjete'); const lEl=document.getElementById('caLentillesProjete');
    if(gEl) gEl.value = Number.isFinite(G1)?fmtEUR(G1):''; if(lEl) lEl.value = Number.isFinite(L1)?fmtEUR(L1):'';
    if(barChart){ barChart.data.datasets[0].data=[G0, Number.isFinite(G1)?G1:0]; barChart.data.datasets[1].data=[L0, Number.isFinite(L1)?L1:0]; barChart.update(); }
  }
  ['caGlobalActuel','caLentillesActuel','objectifPct'].forEach(function(id){ const el=document.getElementById(id); if(el) el.addEventListener('input', updateChart); });
  const btnUpdate=document.getElementById('btnUpdate'); if(btnUpdate) btnUpdate.addEventListener('click', updateChart);
  document.addEventListener('DOMContentLoaded', function(){ buildChart(); updateChart(); });
})();
</script>
</body>
</html>
